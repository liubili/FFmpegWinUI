<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="FFmpegWinUI.Page.ParametersPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:FFmpegWinUI.Page"
    xmlns:viewmodels="using:FFmpegWinUI.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DataContext="{d:DesignInstance Type=viewmodels:ParametersPageViewModel}"
    mc:Ignorable="d">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
            <TextBlock Text="参数面板" Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="配置编码参数和预设"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

            <!-- 预设选择 -->
            <Grid Margin="0,8,0,0" ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <ComboBox Grid.Column="0"
                          PlaceholderText="选择预设..."
                          MinWidth="200"
                          ItemsSource="{x:Bind ViewModel.PresetList, Mode=OneWay}"
                          SelectedItem="{x:Bind ViewModel.SelectedPresetName, Mode=TwoWay}"/>
                <Button Grid.Column="1" Content="加载" Command="{x:Bind ViewModel.LoadPresetCommand}"/>
                <Button Grid.Column="2" Content="保存" Command="{x:Bind ViewModel.SavePresetCommand}"/>
                <Button Grid.Column="3" Content="删除" Command="{x:Bind ViewModel.DeletePresetCommand}"/>
            </Grid>
        </StackPanel>

        <!-- 参数标签页 -->
        <TabView Grid.Row="1" x:Name="ParameterTabView">
            <TabView.TabItems>
                <!-- 输出设置标签 -->
                <TabViewItem Header="输出设置">
                    <ScrollViewer Padding="16">
                        <StackPanel Spacing="16">
                            <TextBlock Text="容器格式" FontWeight="SemiBold"/>
                            <ComboBox MinWidth="200"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.输出容器, Mode=TwoWay}">
                                <x:String>mp4</x:String>
                                <x:String>mkv</x:String>
                                <x:String>avi</x:String>
                                <x:String>mov</x:String>
                                <x:String>webm</x:String>
                                <x:String>flv</x:String>
                            </ComboBox>

                            <TextBlock Text="输出文件扩展名" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <TextBox Text="{x:Bind ViewModel.CurrentPreset.输出文件扩展名, Mode=TwoWay}"
                                     PlaceholderText=".mp4"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabViewItem>

                <!-- 视频参数标签 -->
                <TabViewItem Header="视频参数">
                    <ScrollViewer Padding="16">
                        <StackPanel Spacing="16">
                            <!-- 视频编码器 -->
                            <TextBlock Text="视频编码器" FontWeight="SemiBold"/>
                            <ComboBox MinWidth="200"
                                      ItemsSource="{x:Bind ViewModel.EncoderList, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.SelectedEncoder, Mode=TwoWay}"
                                      PlaceholderText="选择编码器..."/>

                            <!-- 编码器预设 -->
                            <TextBlock Text="编码器预设" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <ComboBox MinWidth="200"
                                      ItemsSource="{x:Bind ViewModel.EncoderPresetList, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.视频参数_编码器_预设, Mode=TwoWay}"
                                      PlaceholderText="选择预设..."/>

                            <!-- 配置文件 -->
                            <TextBlock Text="配置文件 (Profile)" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <ComboBox MinWidth="200"
                                      ItemsSource="{x:Bind ViewModel.ProfileList, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.视频参数_编码器_配置, Mode=TwoWay}"
                                      PlaceholderText="选择配置..."/>

                            <!-- Tune -->
                            <TextBlock Text="Tune 优化" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <ComboBox MinWidth="200"
                                      ItemsSource="{x:Bind ViewModel.TuneList, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.视频参数_编码器_调优, Mode=TwoWay}"
                                      PlaceholderText="选择优化..."/>

                            <!-- 像素格式 -->
                            <TextBlock Text="像素格式" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <ComboBox MinWidth="200"
                                      ItemsSource="{x:Bind ViewModel.PixelFormatList, Mode=OneWay}"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.视频参数_像素格式, Mode=TwoWay}"
                                      PlaceholderText="选择像素格式..."/>

                            <!-- 质量控制 -->
                            <TextBlock Text="质量控制方式" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <ComboBox MinWidth="200"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.视频参数_质量控制_参数名, Mode=TwoWay}">
                                <x:String>crf</x:String>
                                <x:String>qp</x:String>
                                <x:String>bitrate</x:String>
                            </ComboBox>

                            <TextBlock Text="质量值" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <TextBox Text="{x:Bind ViewModel.CurrentPreset.视频参数_质量控制_值, Mode=TwoWay}"
                                     PlaceholderText="例如: 23"/>

                            <!-- 分辨率 -->
                            <TextBlock Text="分辨率设置" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBox Text="{x:Bind ViewModel.CurrentPreset.视频参数_分辨率_宽度, Mode=TwoWay}"
                                         PlaceholderText="宽度" Width="100"/>
                                <TextBlock Text="×" VerticalAlignment="Center"/>
                                <TextBox Text="{x:Bind ViewModel.CurrentPreset.视频参数_分辨率_高度, Mode=TwoWay}"
                                         PlaceholderText="高度" Width="100"/>
                            </StackPanel>

                            <!-- 帧率 -->
                            <TextBlock Text="帧率 (FPS)" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <TextBox Text="{x:Bind ViewModel.CurrentPreset.视频参数_帧率, Mode=TwoWay}"
                                     PlaceholderText="例如: 30"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabViewItem>

                <!-- 音频参数标签 -->
                <TabViewItem Header="音频参数">
                    <ScrollViewer Padding="16">
                        <StackPanel Spacing="16">
                            <!-- 音频编码器 -->
                            <TextBlock Text="音频编码器" FontWeight="SemiBold"/>
                            <ComboBox MinWidth="200"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.音频参数_编码器, Mode=TwoWay}">
                                <x:String>aac</x:String>
                                <x:String>mp3</x:String>
                                <x:String>opus</x:String>
                                <x:String>flac</x:String>
                                <x:String>vorbis</x:String>
                                <x:String>copy</x:String>
                            </ComboBox>

                            <!-- 音频码率 -->
                            <TextBlock Text="音频码率 (kbps)" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <TextBox Text="{x:Bind ViewModel.CurrentPreset.音频参数_码率, Mode=TwoWay}"
                                     PlaceholderText="例如: 192"/>

                            <!-- 采样率 -->
                            <TextBlock Text="采样率 (Hz)" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <ComboBox MinWidth="200"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.音频参数_采样率, Mode=TwoWay}">
                                <x:String>48000</x:String>
                                <x:String>44100</x:String>
                                <x:String>32000</x:String>
                                <x:String>22050</x:String>
                            </ComboBox>

                            <!-- 声道数 -->
                            <TextBlock Text="声道数" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <ComboBox MinWidth="200"
                                      SelectedItem="{x:Bind ViewModel.CurrentPreset.音频参数_声道数, Mode=TwoWay}">
                                <x:String>2</x:String>
                                <x:String>1</x:String>
                                <x:String>6</x:String>
                            </ComboBox>
                        </StackPanel>
                    </ScrollViewer>
                </TabViewItem>

                <!-- 滤镜标签 -->
                <TabViewItem Header="滤镜">
                    <ScrollViewer Padding="16">
                        <StackPanel Spacing="16">
                            <TextBlock Text="视频滤镜" FontWeight="SemiBold"/>
                            <TextBox Text="{x:Bind ViewModel.CurrentPreset.视频参数_滤镜, Mode=TwoWay}"
                                     PlaceholderText="FFmpeg滤镜命令..."
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     MinHeight="100"/>

                            <TextBlock Text="音频滤镜" FontWeight="SemiBold" Margin="0,8,0,0"/>
                            <TextBox Text="{x:Bind ViewModel.CurrentPreset.音频参数_滤镜, Mode=TwoWay}"
                                     PlaceholderText="FFmpeg音频滤镜..."
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     MinHeight="100"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabViewItem>

                <!-- 自定义参数标签 -->
                <TabViewItem Header="自定义参数">
                    <ScrollViewer Padding="16">
                        <StackPanel Spacing="16">
                            <TextBlock Text="额外FFmpeg参数" FontWeight="SemiBold"/>
                            <TextBox Text="{x:Bind ViewModel.CurrentPreset.自定义参数_附加参数, Mode=TwoWay}"
                                     PlaceholderText="自定义参数..."
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     MinHeight="150"/>
                            <TextBlock Text="每行一个参数"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       FontSize="12"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabViewItem>
            </TabView.TabItems>
        </TabView>

        <!-- 底部控制栏 -->
        <Grid Grid.Row="2" Margin="0,8,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 命令行预览 -->
            <Expander Grid.Row="0" Header="命令行预览" HorizontalAlignment="Stretch" IsExpanded="False">
                <ScrollViewer MaxHeight="150" Padding="12">
                    <TextBlock Text="{x:Bind ViewModel.CommandLinePreview, Mode=OneWay}"
                               TextWrapping="Wrap"
                               FontFamily="Consolas"
                               IsTextSelectionEnabled="True"/>
                </ScrollViewer>
            </Expander>

            <!-- 操作按钮 -->
            <CommandBar Grid.Row="1" DefaultLabelPosition="Right">
                <AppBarButton Icon="Save" Label="保存预设" Command="{x:Bind ViewModel.SavePresetCommand}"/>
                <AppBarButton Icon="OpenFile" Label="加载预设" Command="{x:Bind ViewModel.LoadPresetCommand}"/>
                <AppBarButton Icon="Delete" Label="删除预设" Command="{x:Bind ViewModel.DeletePresetCommand}"/>
                <AppBarSeparator/>
                <AppBarButton Icon="View" Label="预览命令" Command="{x:Bind ViewModel.PreviewCommandLineCommand}"/>
                <AppBarButton Icon="Refresh" Label="重置参数" Command="{x:Bind ViewModel.ResetParametersCommand}"/>
            </CommandBar>
        </Grid>
    </Grid>
</Page>
